{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Trace Data Schema",
  "description": "Schema for execution trace data",
  "type": "object",
  "required": ["session_id", "timestamp", "events"],
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique session identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 datetime of trace start"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "agent": {
          "type": "string",
          "description": "Agent that generated trace"
        },
        "user_id_hash": {
          "type": "string",
          "description": "Hashed user identifier"
        },
        "project_hash": {
          "type": "string",
          "description": "Hashed project identifier"
        }
      }
    },
    "events": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/event"
      },
      "description": "Array of trace events"
    },
    "summary": {
      "type": "object",
      "properties": {
        "total_events": {
          "type": "integer",
          "minimum": 0
        },
        "total_duration_ms": {
          "type": "integer",
          "minimum": 0
        },
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "total_cost_estimate": {
          "type": "number",
          "minimum": 0
        }
      }
    }
  },
  "$defs": {
    "event": {
      "type": "object",
      "required": ["event_id", "timestamp", "type"],
      "properties": {
        "event_id": {
          "type": "string",
          "description": "Unique event identifier"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When event occurred"
        },
        "type": {
          "type": "string",
          "enum": ["tool_call", "llm_call", "decision", "error", "checkpoint"],
          "description": "Type of event"
        },
        "tool": {
          "type": "string",
          "description": "Tool name for tool_call events"
        },
        "parameters_redacted": {
          "type": "object",
          "description": "Redacted parameters"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration in milliseconds"
        },
        "success": {
          "type": "boolean",
          "description": "Whether operation succeeded"
        },
        "tokens_in": {
          "type": "integer",
          "minimum": 0,
          "description": "Input token count for LLM calls"
        },
        "tokens_out": {
          "type": "integer",
          "minimum": 0,
          "description": "Output token count for LLM calls"
        }
      }
    }
  },
  "examples": [
    {
      "session_id": "ses_abc123",
      "timestamp": "2024-01-15T10:30:00Z",
      "events": [
        {
          "event_id": "evt_001",
          "timestamp": "2024-01-15T10:30:01Z",
          "type": "tool_call",
          "tool": "read",
          "parameters_redacted": {"file_path": "src/auth.ts"},
          "duration_ms": 45,
          "success": true,
          "tokens_in": 0,
          "tokens_out": 0
        }
      ]
    }
  ]
}